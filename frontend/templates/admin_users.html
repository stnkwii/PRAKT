{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ - –û–û–û "–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-3">
        <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h6 class="mb-0">üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h6>
            </div>
            <div class="list-group list-group-flush">
                <a href="/dashboard" class="list-group-item list-group-item-action">
                    üìä –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
                </a>
                <a href="/admin/users" class="list-group-item list-group-item-action active">
                    üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                </a>
                <a href="/admin/tenders" class="list-group-item list-group-item-action">
                    üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–¥–µ—Ä–∞–º–∏
                </a>
                <a href="/admin/settings" class="list-group-item list-group-item-action">
                    ‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                </a>
                <a href="/admin/reports" class="list-group-item list-group-item-action">
                    üìà –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
                </a>
            </div>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h6>
            </div>
            <div class="card-body">
                <button class="btn btn-outline-primary btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#addUserModal">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </button>
                <button class="btn btn-outline-success btn-sm w-100 mb-2" onclick="exportUsers()">
                    üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                </button>
                <button class="btn btn-outline-info btn-sm w-100" onclick="sendBulkEmail()">
                    ‚úâÔ∏è –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
                </button>
            </div>
        </div>
    </div>

    <div class="col-lg-9">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
            <span class="badge bg-danger">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center py-3">
                        <h4 id="total-users">156</h4>
                        <small>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body text-center py-3">
                        <h4 id="active-users">142</h4>
                        <small>–ê–∫—Ç–∏–≤–Ω—ã—Ö</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body text-center py-3">
                        <h4 id="new-users">8</h4>
                        <small>–ù–æ–≤—ã—Ö (–∑–∞ 7 –¥–Ω–µ–π)</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body text-center py-3">
                        <h4 id="admins-count">3</h4>
                        <small>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="user-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ email –∏–ª–∏ –∏–º–µ–Ω–∏...">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="role-filter">
                            <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</option>
                            <option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
                            <option value="client">–ö–ª–∏–µ–Ω—Ç—ã</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="status-filter">
                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                            <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                            <option value="blocked">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary w-100" onclick="loadUsers()">
                            üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
                <div>
                    <span class="badge bg-light text-dark" id="users-count">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                <th>üìß Email</th>
                                <th>üé≠ –†–æ–ª—å</th>
                                <th>üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
                                <th>üìä –°—Ç–∞—Ç—É—Å</th>
                                <th>‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                            <tr>
                                <td colspan="7" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                    </div>
                                    <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-4">
                    <ul class="pagination justify-content-center" id="pagination">
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="add-user-form">
                    <div class="mb-3">
                        <label class="form-label">üìß Email</label>
                        <input type="email" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">üë§ –ò–º—è</label>
                        <input type="text" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">üîí –ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">üé≠ –†–æ–ª—å</label>
                        <select class="form-select" required>
                            <option value="client">–ö–ª–∏–µ–Ω—Ç</option>
                            <option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="addUser()">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="edit-user-form">
                    <input type="hidden" id="edit-user-id">
                    <div class="mb-3">
                        <label class="form-label">üìß Email</label>
                        <input type="email" class="form-control" id="edit-user-email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">üë§ –ò–º—è</label>
                        <input type="text" class="form-control" id="edit-user-name">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">üé≠ –†–æ–ª—å</label>
                        <select class="form-select" id="edit-user-role" required>
                            <option value="client">–ö–ª–∏–µ–Ω—Ç</option>
                            <option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">üìä –°—Ç–∞—Ç—É—Å</label>
                        <select class="form-select" id="edit-user-status" required>
                            <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                            <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                            <option value="blocked">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="saveUserChanges()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
    </div>
</div>

<script>
// Mock –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const MOCK_USERS = [
    {
        id: 1,
        email: 'admin@sys-sec.ru',
        name: '–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
        role: 'admin',
        status: 'active',
        created_at: '2024-01-01T10:00:00',
        last_login: '2024-12-19T15:30:00'
    },
    {
        id: 2,
        email: 'manager@sys-sec.ru',
        name: '–ò–≤–∞–Ω –ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤',
        role: 'manager',
        status: 'active',
        created_at: '2024-01-02T11:20:00',
        last_login: '2024-12-18T14:15:00'
    },
    {
        id: 3,
        email: 'client@sys-sec.ru',
        name: '–ü–µ—Ç—Ä –ö–ª–∏–µ–Ω—Ç–æ–≤',
        role: 'client',
        status: 'active',
        created_at: '2024-01-03T09:45:00',
        last_login: '2024-12-19T10:20:00'
    },
    {
        id: 4,
        email: 'user1@example.com',
        name: '–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞',
        role: 'client',
        status: 'active',
        created_at: '2024-01-04T16:30:00',
        last_login: '2024-12-17T11:45:00'
    },
    {
        id: 5,
        email: 'user2@example.com',
        name: '–°–µ—Ä–≥–µ–π –ò–≤–∞–Ω–æ–≤',
        role: 'client',
        status: 'inactive',
        created_at: '2024-01-05T14:15:00',
        last_login: '2024-11-20T09:30:00'
    },
    {
        id: 6,
        email: 'user3@example.com',
        name: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞',
        role: 'manager',
        status: 'active',
        created_at: '2024-01-06T13:20:00',
        last_login: '2024-12-19T16:40:00'
    }
];

let currentPage = 1;
const usersPerPage = 5;

document.addEventListener('DOMContentLoaded', function() {
    loadUsers();
    updateStats();
});

function loadUsers(page = 1) {
    currentPage = page;
    
    const search = document.getElementById('user-search').value.toLowerCase();
    const roleFilter = document.getElementById('role-filter').value;
    const statusFilter = document.getElementById('status-filter').value;
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    let filteredUsers = MOCK_USERS.filter(user => {
        const matchesSearch = !search || 
            user.email.toLowerCase().includes(search) || 
            (user.name && user.name.toLowerCase().includes(search));
        const matchesRole = !roleFilter || user.role === roleFilter;
        const matchesStatus = !statusFilter || user.status === statusFilter;
        
        return matchesSearch && matchesRole && matchesStatus;
    });
    
    // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
    const totalUsers = filteredUsers.length;
    const totalPages = Math.ceil(totalUsers / usersPerPage);
    const startIndex = (page - 1) * usersPerPage;
    const paginatedUsers = filteredUsers.slice(startIndex, startIndex + usersPerPage);
    
    displayUsers(paginatedUsers);
    setupPagination(totalUsers, totalPages, page);
    updateStats();
}

function displayUsers(users) {
    const tbody = document.getElementById('users-table-body');
    
    if (users.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <div class="h1 text-muted">üë•</div>
                    <h5 class="text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                    <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
                </td>
            </tr>
        `;
        return;
    }
    
    let html = '';
    users.forEach(user => {
        const createdDate = new Date(user.created_at).toLocaleDateString('ru-RU');
        const lastLogin = user.last_login ? new Date(user.last_login).toLocaleDateString('ru-RU') : '–ù–∏–∫–æ–≥–¥–∞';
        
        html += `
            <tr>
                <td><strong>#${user.id}</strong></td>
                <td>
                    <div class="d-flex align-items-center">
                        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-2" 
                             style="width: 32px; height: 32px; color: white; font-size: 14px;">
                            üë§
                        </div>
                        <div>
                            <div class="fw-bold">${user.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                            <small class="text-muted">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: ${lastLogin}</small>
                        </div>
                    </div>
                </td>
                <td>${user.email}</td>
                <td>
                    <span class="badge ${getRoleBadgeClass(user.role)}">
                        ${getRoleText(user.role)}
                    </span>
                </td>
                <td>${createdDate}</td>
                <td>
                    <span class="badge ${getStatusBadgeClass(user.status)}">
                        ${getStatusText(user.status)}
                    </span>
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary" onclick="editUser(${user.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            ‚úèÔ∏è
                        </button>
                        <button class="btn btn-outline-${user.status === 'active' ? 'warning' : 'success'}" 
                                onclick="toggleUserStatus(${user.id})" 
                                title="${user.status === 'active' ? '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'}">
                            ${user.status === 'active' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                        </button>
                        <button class="btn btn-outline-danger" onclick="deleteUser(${user.id})" title="–£–¥–∞–ª–∏—Ç—å">
                            üóëÔ∏è
                        </button>
                    </div>
                </td>
            </tr>
        `;
    });
    
    tbody.innerHTML = html;
}

function getRoleBadgeClass(role) {
    const classes = {
        'admin': 'bg-danger',
        'manager': 'bg-warning',
        'client': 'bg-success'
    };
    return classes[role] || 'bg-secondary';
}

function getRoleText(role) {
    const texts = {
        'admin': '–ê–¥–º–∏–Ω',
        'manager': '–ú–µ–Ω–µ–¥–∂–µ—Ä',
        'client': '–ö–ª–∏–µ–Ω—Ç'
    };
    return texts[role] || role;
}

function getStatusBadgeClass(status) {
    const classes = {
        'active': 'bg-success',
        'inactive': 'bg-secondary',
        'blocked': 'bg-danger'
    };
    return classes[status] || 'bg-secondary';
}

function getStatusText(status) {
    const texts = {
        'active': '–ê–∫—Ç–∏–≤–µ–Ω',
        'inactive': '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω',
        'blocked': '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'
    };
    return texts[status] || status;
}

function setupPagination(totalUsers, totalPages, currentPage) {
    const pagination = document.getElementById('pagination');
    const usersCount = document.getElementById('users-count');
    
    usersCount.textContent = `${totalUsers} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
    
    if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
    }
    
    let html = '';
    
    // –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="loadUsers(${currentPage - 1})">‚Äπ –ù–∞–∑–∞–¥</a>
    </li>`;
    
    // –°—Ç—Ä–∞–Ω–∏—Ü—ã
    for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage) {
            html += `<li class="page-item active"><span class="page-link">${i}</span></li>`;
        } else {
            html += `<li class="page-item"><a class="page-link" href="#" onclick="loadUsers(${i})">${i}</a></li>`;
        }
    }
    
    // –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="loadUsers(${currentPage + 1})">–í–ø–µ—Ä–µ–¥ ‚Ä∫</a>
    </li>`;
    
    pagination.innerHTML = html;
}

function updateStats() {
    const totalUsers = MOCK_USERS.length;
    const activeUsers = MOCK_USERS.filter(u => u.status === 'active').length;
    const newUsers = MOCK_USERS.filter(u => {
        const created = new Date(u.created_at);
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        return created > weekAgo;
    }).length;
    const adminsCount = MOCK_USERS.filter(u => u.role === 'admin').length;
    
    document.getElementById('total-users').textContent = totalUsers;
    document.getElementById('active-users').textContent = activeUsers;
    document.getElementById('new-users').textContent = newUsers;
    document.getElementById('admins-count').textContent = adminsCount;
}

// –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
function editUser(userId) {
    const user = MOCK_USERS.find(u => u.id === userId);
    if (user) {
        document.getElementById('edit-user-id').value = user.id;
        document.getElementById('edit-user-email').value = user.email;
        document.getElementById('edit-user-name').value = user.name || '';
        document.getElementById('edit-user-role').value = user.role;
        document.getElementById('edit-user-status').value = user.status;
        
        const modal = new bootstrap.Modal(document.getElementById('editUserModal'));
        modal.show();
    }
}

function saveUserChanges() {
    const userId = parseInt(document.getElementById('edit-user-id').value);
    const userIndex = MOCK_USERS.findIndex(u => u.id === userId);
    
    if (userIndex !== -1) {
        MOCK_USERS[userIndex].email = document.getElementById('edit-user-email').value;
        MOCK_USERS[userIndex].name = document.getElementById('edit-user-name').value;
        MOCK_USERS[userIndex].role = document.getElementById('edit-user-role').value;
        MOCK_USERS[userIndex].status = document.getElementById('edit-user-status').value;
        
        alert('‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        loadUsers(currentPage);
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('editUserModal'));
        modal.hide();
    }
}

function toggleUserStatus(userId) {
    const user = MOCK_USERS.find(u => u.id === userId);
    if (user) {
        user.status = user.status === 'active' ? 'inactive' : 'active';
        loadUsers(currentPage);
        alert(`‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ "${getStatusText(user.status)}"`);
    }
}

function deleteUser(userId) {
    if (confirm('‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
        const userIndex = MOCK_USERS.findIndex(u => u.id === userId);
        if (userIndex !== -1 && MOCK_USERS[userIndex].email !== 'admin@sys-sec.ru') {
            MOCK_USERS.splice(userIndex, 1);
            loadUsers(currentPage);
            alert('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω!');
        } else {
            alert('‚ùå –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
        }
    }
}

function addUser() {
    alert('‚úÖ –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –±—É–¥—É—â–µ–º!');
    const modal = bootstrap.Modal.getInstance(document.getElementById('addUserModal'));
    modal.hide();
}

function exportUsers() {
    alert('üìä –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Excel –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –±—É–¥—É—â–µ–º!');
}

function sendBulkEmail() {
    alert('‚úâÔ∏è –§—É–Ω–∫—Ü–∏—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –±—É–¥—É—â–µ–º!');
}

// –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
document.getElementById('user-search').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        loadUsers(1);
    }
});
</script>

<style>
.table th {
    border-top: none;
    font-weight: 600;
    color: #495057;
}

.btn-group-sm > .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-1px);
}
</style>
{% endblock %}