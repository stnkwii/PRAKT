{% extends "base.html" %}

{% block title %}–í—Ö–æ–¥ - –û–û–û "–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h4>
            </div>
            <div class="card-body">
                <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ -->
                <div id="demo-notification" class="alert alert-info">
                    <strong>üí° –î–µ–º–æ-—Ä–µ–∂–∏–º:</strong> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏. –í—Å–µ —Ç—Ä–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω—ã.
                </div>
                
                <form id="login-form">
                    <div class="mb-3">
                        <label for="email" class="form-label">üìß Email</label>
                        <input type="email" class="form-control" id="email" required 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email">
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">üîí –ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="password" required 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button type="submit" class="btn btn-primary w-100" id="login-button">
                        <span class="spinner-border spinner-border-sm d-none" id="login-spinner" role="status"></span>
                        üöÄ –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                    </button>
                </form>
                
                <div class="mt-3 text-center">
                    <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="/register" class="text-decoration-none">üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
                </div>
                
                <div id="login-message" class="mt-3"></div>
            </div>
        </div>
        
        <!-- –¢–µ—Å—Ç–æ–≤—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ -->
        <div class="card mt-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">üë• –¢–µ—Å—Ç–æ–≤—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-danger">
                            <div class="card-body text-center">
                                <h6 class="card-title">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h6>
                                <p class="card-text small">
                                    <strong>Email:</strong> admin@sys-sec.ru<br>
                                    <strong>–ü–∞—Ä–æ–ª—å:</strong> admin123
                                </p>
                                <button class="btn btn-outline-danger btn-sm test-account" data-account="admin">
                                    –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-warning">
                            <div class="card-body text-center">
                                <h6 class="card-title">üíº –ú–µ–Ω–µ–¥–∂–µ—Ä</h6>
                                <p class="card-text small">
                                    <strong>Email:</strong> manager@sys-sec.ru<br>
                                    <strong>–ü–∞—Ä–æ–ª—å:</strong> manager123
                                </p>
                                <button class="btn btn-outline-warning btn-sm test-account" data-account="manager">
                                    –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-success">
                            <div class="card-body text-center">
                                <h6 class="card-title">üë§ –ö–ª–∏–µ–Ω—Ç</h6>
                                <p class="card-text small">
                                    <strong>Email:</strong> client@sys-sec.ru<br>
                                    <strong>–ü–∞—Ä–æ–ª—å:</strong> client123
                                </p>
                                <button class="btn btn-outline-success btn-sm test-account" data-account="client">
                                    –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning mt-3">
                    <small>
                        <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ö–∞–∂–¥–∞—è —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
                        <ul class="mb-0 mt-1">
                            <li><strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</strong> - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º</li>
                            <li><strong>–ú–µ–Ω–µ–¥–∂–µ—Ä</strong> - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–¥–µ—Ä–∞–º–∏ –∏ –∑–∞—è–≤–∫–∞–º–∏</li>
                            <li><strong>–ö–ª–∏–µ–Ω—Ç</strong> - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–Ω–¥–µ—Ä–æ–≤ –∏ –ø–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫</li>
                        </ul>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('login-form');
    const loginButton = document.getElementById('login-button');
    const loginSpinner = document.getElementById('login-spinner');
    const loginMessage = document.getElementById('login-message');
    
    // –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
    document.querySelectorAll('.test-account').forEach(button => {
        button.addEventListener('click', function() {
            const account = this.dataset.account;
            const accounts = {
                'admin': { 
                    email: 'admin@sys-sec.ru', 
                    password: 'admin123',
                    role: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
                },
                'manager': { 
                    email: 'manager@sys-sec.ru', 
                    password: 'manager123',
                    role: '–ú–µ–Ω–µ–¥–∂–µ—Ä'
                },
                'client': { 
                    email: 'client@sys-sec.ru', 
                    password: 'client123',
                    role: '–ö–ª–∏–µ–Ω—Ç'
                }
            };
            
            if (accounts[account]) {
                document.getElementById('email').value = accounts[account].email;
                document.getElementById('password').value = accounts[account].password;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ä–æ–ª–∏
                loginMessage.innerHTML = `
                    <div class="alert alert-info">
                        <strong>–í—ã–±—Ä–∞–Ω–∞ —Ä–æ–ª—å:</strong> ${accounts[account].role}<br>
                        <small>–ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É" –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</small>
                    </div>
                `;
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
                loginForm.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });
    
    loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!email || !password) {
            loginMessage.innerHTML = `
                <div class="alert alert-danger">
                    ‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è
                </div>
            `;
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
        loginButton.disabled = true;
        loginSpinner.classList.remove('d-none');
        loginButton.innerHTML = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...';
        
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        loginMessage.innerHTML = '';
        
        try {
            const result = await safeLogin(email, password);
            
            if (result.success) {
                loginMessage.innerHTML = `
                    <div class="alert alert-success">
                        ‚úÖ <strong>–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!</strong><br>
                        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${result.data.name || result.data.email}!<br>
                        <small>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç...</small>
                    </div>
                `;
                
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
                setTimeout(() => {
                    window.location.href = '/dashboard';
                }, 1500);
            } else {
                loginMessage.innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå <strong>–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:</strong><br>
                        ${result.error}
                    </div>
                `;
            }
        } catch (error) {
            loginMessage.innerHTML = `
                <div class="alert alert-danger">
                    ‚ùå <strong>–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:</strong><br>
                    ${error.message}
                </div>
            `;
        } finally {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            loginButton.disabled = false;
            loginSpinner.classList.add('d-none');
            loginButton.innerHTML = 'üöÄ –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É';
        }
    });
});
</script>

<style>
.test-account {
    transition: all 0.3s ease;
}

.test-account:hover {
    transform: translateY(-2px);
}

.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}
</style>
{% endblock %}