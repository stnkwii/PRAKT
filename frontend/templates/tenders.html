{% extends "base.html" %}

{% block title %}–¢–µ–Ω–¥–µ—Ä—ã - –û–û–û "–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>üìã –°–ø–∏—Å–æ–∫ —Ç–µ–Ω–¥–µ—Ä–æ–≤</h1>
    {% if session.get('user_role') in ['admin', 'manager'] %}
    <a href="/tenders/create" class="btn btn-primary">‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–µ–Ω–¥–µ—Ä</a>
    {% endif %}
</div>

<div class="card">
    <div class="card-header">
        <div class="row">
            <div class="col-md-6">
                <input type="text" class="form-control" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é...">
            </div>
            <div class="col-md-3">
                <select class="form-select" id="status-filter">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="active" selected>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                    <option value="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</option>
                    <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
                    <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ</option>
                </select>
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary w-100" onclick="loadTenders()">
                    <span class="spinner-border spinner-border-sm d-none" id="search-spinner"></span>
                    üîç –ü–æ–∏—Å–∫
                </button>
            </div>
        </div>
    </div>
    
    <div class="card-body">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ -->
        <div id="demo-notice" class="alert alert-info d-none">
            <strong>üìù –î–µ–º–æ-—Ä–µ–∂–∏–º:</strong> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä API.
        </div>

        <div id="tenders-list">
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤...</span>
                </div>
                <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–µ–Ω–¥–µ—Ä–æ–≤...</p>
            </div>
        </div>
        
        <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-4">
            <ul class="pagination justify-content-center" id="pagination">
            </ul>
        </nav>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤ -->
<div class="row mt-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body text-center">
                <h4 id="stats-active">0</h4>
                <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ–Ω–¥–µ—Ä–æ–≤</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body text-center">
                <h4 id="stats-total">0</h4>
                <p>–í—Å–µ–≥–æ —Ç–µ–Ω–¥–µ—Ä–æ–≤</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body text-center">
                <h4 id="stats-applications">0</h4>
                <p>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body text-center">
                <h4 id="stats-budget">0</h4>
                <p>–û–±—â–∏–π –±—é–¥–∂–µ—Ç</p>
            </div>
        </div>
    </div>
</div>

<script>
let currentPage = 1;
const perPage = 10;

// Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
const MOCK_TENDERS = [
    {
        id: 1,
        title: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏',
        description: '–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å–µ—Ç–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è. –í–∫–ª—é—á–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ —É–≥—Ä–æ–∑, –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∑–∞—â–∏—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤.',
        customer: '–û–û–û "–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"',
        budget: 2500000.00,
        currency: 'RUB',
        status: 'active',
        tender_type: 'open',
        deadline: '2024-12-31T23:59:59',
        created_at: '2024-01-15T10:00:00',
        applications_count: 3,
        created_by: 1
    },
    {
        id: 2,
        title: '–í–Ω–µ–¥—Ä–µ–Ω–∏–µ SIEM —Å–∏—Å—Ç–µ–º—ã',
        description: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –í–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–∞–≤–∏–ª –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, –æ–±—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞.',
        customer: '–û–û–û "–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"',
        budget: 1500000.00,
        currency: 'RUB',
        status: 'active',
        tender_type: 'open',
        deadline: '2024-12-25T23:59:59',
        created_at: '2024-01-10T14:30:00',
        applications_count: 5,
        created_by: 1
    },
    {
        id: 3,
        title: '–ê—É–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
        description: '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–≤, –∞–Ω–∞–ª–∏–∑ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ.',
        customer: '–û–û–û "–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"',
        budget: 800000.00,
        currency: 'RUB',
        status: 'active',
        tender_type: 'closed',
        deadline: '2024-11-30T23:59:59',
        created_at: '2024-01-05T09:15:00',
        applications_count: 2,
        created_by: 1
    },
    {
        id: 4,
        title: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
        description: '–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ–±—ã—Ç–∏–π.',
        customer: '–û–û–û "–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"',
        budget: 1200000.00,
        currency: 'RUB',
        status: 'draft',
        tender_type: 'open',
        deadline: '2024-12-15T23:59:59',
        created_at: '2024-01-20T16:45:00',
        applications_count: 0,
        created_by: 1
    },
    {
        id: 5,
        title: '–û–±—É—á–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
        description: '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏–Ω–≥–æ–≤ –∏ –æ–±—É—á–∞—é—â–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –æ—Å–Ω–æ–≤–∞–º –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Ç–∏–≤–æ–¥–µ–π—Å—Ç–≤–∏—é —Ñ–∏—à–∏–Ω–≥–æ–≤—ã–º –∞—Ç–∞–∫–∞–º.',
        customer: '–û–û–û "–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"',
        budget: 500000.00,
        currency: 'RUB',
        status: 'completed',
        tender_type: 'open',
        deadline: '2024-01-10T23:59:59',
        created_at: '2023-12-01T11:20:00',
        applications_count: 8,
        created_by: 1
    }
];

document.addEventListener('DOMContentLoaded', function() {
    loadTenders();
    loadTenderStats();
    
    // –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
    document.getElementById('search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            loadTenders();
        }
    });
});

async function loadTenders(page = 1) {
    currentPage = page;
    
    const search = document.getElementById('search-input').value;
    const status = document.getElementById('status-filter').value;
    const searchSpinner = document.getElementById('search-spinner');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
    searchSpinner.classList.remove('d-none');
    
    try {
        // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å API
        let url = `/api/tenders?page=${page}&per_page=${perPage}`;
        if (search) url += `&search=${encodeURIComponent(search)}`;
        if (status) url += `&status=${status}`;
        
        const response = await fetch(url);
        
        if (response.ok) {
            const data = await response.json();
            displayTenders(data.tenders || []);
            setupPagination(data.total || 0, data.total_pages || 1, page);
            document.getElementById('demo-notice').classList.add('d-none');
        } else {
            // –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º mock –¥–∞–Ω–Ω—ã–µ
            throw new Error('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }
        
    } catch (error) {
        console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ:', error.message);
        document.getElementById('demo-notice').classList.remove('d-none');
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º mock –¥–∞–Ω–Ω—ã–µ
        const filteredTenders = filterMockTenders(search, status);
        const total = filteredTenders.length;
        const totalPages = Math.ceil(total / perPage);
        const startIndex = (page - 1) * perPage;
        const paginatedTenders = filteredTenders.slice(startIndex, startIndex + perPage);
        
        displayTenders(paginatedTenders);
        setupPagination(total, totalPages, page);
    } finally {
        // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
        searchSpinner.classList.add('d-none');
    }
}

function filterMockTenders(search, status) {
    let filtered = [...MOCK_TENDERS];
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
    if (status) {
        filtered = filtered.filter(tender => tender.status === status);
    }
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
    if (search) {
        const searchLower = search.toLowerCase();
        filtered = filtered.filter(tender => 
            tender.title.toLowerCase().includes(searchLower) ||
            tender.description.toLowerCase().includes(searchLower) ||
            tender.customer.toLowerCase().includes(searchLower)
        );
    }
    
    return filtered;
}

function displayTenders(tenders) {
    const tendersList = document.getElementById('tenders-list');
    
    if (!tenders || tenders.length === 0) {
        tendersList.innerHTML = `
            <div class="text-center py-5">
                <div class="h1 text-muted">üìã</div>
                <h4 class="text-muted">–¢–µ–Ω–¥–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
                <button class="btn btn-outline-primary mt-2" onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            </div>
        `;
        return;
    }
    
    let html = '';
    tenders.forEach(tender => {
        const deadline = tender.deadline ? new Date(tender.deadline).toLocaleDateString('ru-RU') : '–Ω–µ —É–∫–∞–∑–∞–Ω';
        const created = tender.created_at ? new Date(tender.created_at).toLocaleDateString('ru-RU') : '–Ω–µ —É–∫–∞–∑–∞–Ω–∞';
        const budget = tender.budget ? new Intl.NumberFormat('ru-RU').format(tender.budget) + ' ' + (tender.currency || 'RUB') : '–Ω–µ —É–∫–∞–∑–∞–Ω';
        
        html += `
            <div class="card mb-3 tender-card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h5 class="card-title">
                                <a href="/tenders/${tender.id}" class="text-decoration-none">${tender.title}</a>
                                <span class="badge ${getStatusBadgeColor(tender.status)} ms-2">
                                    ${getStatusText(tender.status)}
                                </span>
                                ${tender.tender_type === 'closed' ? '<span class="badge bg-dark ms-1">–ó–∞–∫—Ä—ã—Ç—ã–π</span>' : ''}
                            </h5>
                            <p class="card-text">${tender.description}</p>
                            <div class="text-muted small">
                                <strong>–ó–∞–∫–∞–∑—á–∏–∫:</strong> ${tender.customer} | 
                                <strong>–ë—é–¥–∂–µ—Ç:</strong> ${budget} |
                                <strong>–ó–∞—è–≤–æ–∫:</strong> ${tender.applications_count || 0}
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="mb-2">
                                <strong>–°—Ä–æ–∫ –ø–æ–¥–∞—á–∏:</strong><br>
                                <span class="text-${isDeadlineApproaching(tender.deadline) ? 'danger' : 'success'}">${deadline}</span>
                            </div>
                            <div class="mb-3">
                                <small class="text-muted">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω: ${created}</small>
                            </div>
                            <div class="btn-group">
                                <a href="/tenders/${tender.id}" class="btn btn-outline-primary btn-sm">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                                {% if session.get('user_id') %}
                                <a href="/tenders/${tender.id}/apply" class="btn btn-primary btn-sm">üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</a>
                                {% else %}
                                <a href="/login" class="btn btn-outline-secondary btn-sm">üîê –í–æ–π—Ç–∏ –¥–ª—è —É—á–∞—Å—Ç–∏—è</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    tendersList.innerHTML = html;
}

function isDeadlineApproaching(deadline) {
    if (!deadline) return false;
    const deadlineDate = new Date(deadline);
    const now = new Date();
    const diffTime = deadlineDate - now;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    return diffDays <= 7 && diffDays > 0;
}

function getStatusBadgeColor(status) {
    const colors = {
        'active': 'bg-success',
        'draft': 'bg-secondary',
        'completed': 'bg-info',
        'cancelled': 'bg-danger'
    };
    return colors[status] || 'bg-secondary';
}

function getStatusText(status) {
    const texts = {
        'active': '–ê–∫—Ç–∏–≤–Ω—ã–π',
        'draft': '–ß–µ—Ä–Ω–æ–≤–∏–∫',
        'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
        'cancelled': '–û—Ç–º–µ–Ω–µ–Ω'
    };
    return texts[status] || status;
}

function setupPagination(total, totalPages, currentPage) {
    const pagination = document.getElementById('pagination');
    
    if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
    }
    
    let html = '';
    
    // –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="loadTenders(${currentPage - 1})" tabindex="-1">‚Äπ –ù–∞–∑–∞–¥</a>
    </li>`;
    
    // –°—Ç—Ä–∞–Ω–∏—Ü—ã
    const startPage = Math.max(1, currentPage - 2);
    const endPage = Math.min(totalPages, startPage + 4);
    
    for (let i = startPage; i <= endPage; i++) {
        if (i === currentPage) {
            html += `<li class="page-item active"><span class="page-link">${i}</span></li>`;
        } else {
            html += `<li class="page-item"><a class="page-link" href="#" onclick="loadTenders(${i})">${i}</a></li>`;
        }
    }
    
    // –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="loadTenders(${currentPage + 1})">–í–ø–µ—Ä–µ–¥ ‚Ä∫</a>
    </li>`;
    
    pagination.innerHTML = html;
}

function resetFilters() {
    document.getElementById('search-input').value = '';
    document.getElementById('status-filter').value = 'active';
    loadTenders(1);
}

async function loadTenderStats() {
    try {
        const response = await fetch('/api/tenders');
        if (response.ok) {
            const data = await response.json();
            const tenders = data.tenders || [];
            
            const activeTenders = tenders.filter(t => t.status === 'active').length;
            const totalTenders = tenders.length;
            const totalApplications = tenders.reduce((sum, t) => sum + (t.applications_count || 0), 0);
            const totalBudget = tenders.reduce((sum, t) => sum + (t.budget || 0), 0);
            
            document.getElementById('stats-active').textContent = activeTenders;
            document.getElementById('stats-total').textContent = totalTenders;
            document.getElementById('stats-applications').textContent = totalApplications;
            document.getElementById('stats-budget').textContent = new Intl.NumberFormat('ru-RU').format(totalBudget) + ' ‚ÇΩ';
        } else {
            throw new Error('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }
    } catch (error) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º mock —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        const activeTenders = MOCK_TENDERS.filter(t => t.status === 'active').length;
        const totalTenders = MOCK_TENDERS.length;
        const totalApplications = MOCK_TENDERS.reduce((sum, t) => sum + (t.applications_count || 0), 0);
        const totalBudget = MOCK_TENDERS.reduce((sum, t) => sum + (t.budget || 0), 0);
        
        document.getElementById('stats-active').textContent = activeTenders;
        document.getElementById('stats-total').textContent = totalTenders;
        document.getElementById('stats-applications').textContent = totalApplications;
        document.getElementById('stats-budget').textContent = new Intl.NumberFormat('ru-RU').format(totalBudget) + ' ‚ÇΩ';
    }
}
</script>

<style>
.tender-card {
    transition: all 0.3s ease;
    border-left: 4px solid #007bff;
}

.tender-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.tender-card.bg-warning {
    border-left-color: #ffc107;
}

.tender-card.bg-success {
    border-left-color: #28a745;
}

.tender-card.bg-info {
    border-left-color: #17a2b8;
}
</style>
{% endblock %}